<?php

use Application\View\Helper\BotaoSimples;

$mensagem[1] = 'Chegou a hora de escolher o futuro da sua família. Conto com o seu voto para continuar esta luta. Vote DELMASSO 10456.';
$mensagem[2] = 'A hora de escolher o futuro da sua família chegou. Conto com o seu voto para continuar nesta luta. Vote DELMASSO 10456!';
$mensagem[3] = 'Chegou a hora de escolher o futuro da sua família. Conto com o seu voto para continuar e ficar firme nesta luta. Vote DELMASSO 10456.';
$mensagem[4] = 'Chegou a hora de escolher o futuro da sua família. Conto com o seu voto para permanecer nesta luta. Vote DELMASSO 10456!';
$mensagem[5] = 'A hora de escolher o futuro de nossas famílias chegou. Conto com o seu voto para continuar firme nesta luta. Vote DELMASSO 10456!';

$html = '';
if($eleitores = $this->eleitores){
	$html .= '<div class="center-block">';

	$html .= '<div class="panel">';

	$html .= '<div class="panel-heading" style="padding: 0px"><div class="panel-title">Eleitores</div></div>';
	$html .= '<div class="panel-body p10">';

	$html .= '<div class="panel">';
	$html .= '<div class="panel-body">';
	$totalDeBlocos = $this->totalDeBlocos;
	for($indiceBlocos = $totalDeBlocos; $indiceBlocos >= 0; $indiceBlocos--){
		$funcaoBloco = $this->funcaoOnClick('location.href="/deployEleitor/'.$indiceBlocos.'"');
		$html .= $this->botaoSimples($indiceBlocos, $funcaoBloco);
	}
	$html .= '</div>';
	$html .= '</div>';

	$html .= '<table class="table table-bordered table-condensed table-hover" >';
	$html .= '<thead>';
	$html .= '<tr class="dark">';
	$html .= '<td class="hidden-xs">id</td>';
	$html .= '<td class="hidden-xs">Igreja</td>';
	$html .= '<td class="hidden-xs">Equipe</td>';
	$html .= '<td class="hidden-xs">Nome</td>';
	$html .= '<td class="hidden-xs">Telefone</td>';
	$html .= '<td class="hidden-xs">Lista</td>';
	$html .= '<td>Sit.</td>';
	$html .= '<td>Opçoes</td>';
	$html .= '<td>Envio</td>';
	$html .= '</tr>';
	$html .= '</thead>';
	$html .= '<tbody>';
	foreach($eleitores as $eleitor){
		$numeroRandom = rand(1,5);
		$mensagemParaUsar = $mensagem[$numeroRandom];

		$botaoEnvioSem9 = '<a target="_blanck" class="botaoEnvio btn btn-success" href="https://api.whatsapp.com/send?phone=55'.$eleitor->getTelefone().'&text='.$mensagemParaUsar.'">'.$eleitor->getId().'</a>';

		$funcaoOnclickEnviado = $this->funcaoOnClick('mudarSituacao('.$eleitor->getId().',2)');
		$funcaoOnclickInvalido = $this->funcaoOnClick('mudarSituacao('.$eleitor->getId().',3)');
		$botaoEnviado = $this->botaoSimples('<i class="fa fa-check"></i>',' id="botaoEnviado'.$eleitor->getId().'" '.$funcaoOnclickEnviado,BotaoSimples::botaoSucesso, BotaoSimples::posicaoAEsquerda);
		$botaoError = $this->botaoSimples('<i class="fa fa-ban"></i>',' id="botaoInvalido'.$eleitor->getId().'" '.$funcaoOnclickInvalido,BotaoSimples::botaoPerigoso, BotaoSimples::posicaoAEsquerda);
		$botoes = $botaoEnviado . ' ' .$botaoError;

		switch($eleitor->getSituacao()){
		case 1: $label = '<i class="fa fa-clock-o"></i>';$classe = 'warning';  break;
		case 2: $label = '<i class="fa fa-check"></i>';$classe = 'success';  break;
		case 3: $label = '<i class="fa fa-ban"></i>';$classe = 'danger';  break;
		}
		$situacaoAtual = '<span id="situacao'.$eleitor->getId().'" class="label label-'.$classe.'">'.$label.'</span>';
		$html .= '<tr>';
		$html .= '<td class="hidden-xs">'.$eleitor->getId().'</td>';
		$html .= '<td class="hidden-xs">'.$eleitor->getIgreja().'</td>';
		$html .= '<td class="hidden-xs">'.$eleitor->getEquipe().'</td>';
		$html .= '<td class="hidden-xs">'.$eleitor->getNome().'</td>';
		$html .= '<td class="hidden-xs">'.$eleitor->getTelefone().'</td>';
		$html .= '<td class="hidden-xs">'.$eleitor->getLista().'</td>';
		$html .= '<td>'.$situacaoAtual.'</td>';
		$html .= '<td>'.$botoes.'</td>';
		$html .= '<td>'.$botaoEnvioSem9.'</td>';
		$html .= '</tr>';
	}
	$html .= '</tbody>';

	$html .= '<tfoot class="footer-menu">';
	$html .= '<tr>';
	$html .= '<td colspan="8">';
	$html .= '<nav class="text-right">';
	$html .= '<ul class="pagination"></ul>';
	$html .= '</nav>';
	$html .= '</td>';
	$html .= '</tr>';
	$html .= '</tfoot>';
	$html .= '</table>';
	$html .= '</div>';

	$html .= '</div>';

	$html .= '</div>';
}

echo $html;

?>
<script type="text/javascript">

function mudarSituacao(idEleitor, tipo){
	$.post(
		"/deployEleitorMudarSituacao",
{
	idEleitor: idEleitor,
		tipo: tipo,
			},
			function (data) {
				if (data.response) {
					let label = '<i class="fa fa-check"></i>'
						let classeParaAdicionar = 'label-success'
						let classeParaRemover = 'label-warning label-danger'
						if(tipo == 3){
							label = '<i class="fa fa-ban"></i>'
								classeParaAdicionar = 'label-danger'
								classeParaRemover = 'label-warning label-success'
					}
					$('#situacao'+idEleitor).html(label)
						$('#situacao'+idEleitor).addClass(classeParaAdicionar)
						$('#situacao'+idEleitor).removeClass(classeParaRemover)
				   } 
			}, 'json');
}

</script>
