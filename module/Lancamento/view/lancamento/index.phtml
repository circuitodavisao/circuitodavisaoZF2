<?php

use Lancamento\Controller\Helper\ConstantesLancamento;
use Lancamento\Controller\Helper\FuncoesLancamento;

$mesSelecionado = FuncoesLancamento::mesPorAbaSelecionada($this->abaSelecionada);
$anoSelecionado = FuncoesLancamento::anoPorAbaSelecionada($this->abaSelecionada);
?>
<div class="row">
    <div class="col-md-6">
        <?php echo $this->dadosEntidade($entidade); ?>
    </div> 
    <div class="col-md-6">
        <?php echo $this->alertaEnvioRelatorio(1); ?>
        <?php echo $this->alertaEnvioRelatorio(2); ?>
        <?php echo $this->alertaEnvioRelatorio(3); ?>
    </div> 
</div>
<div class="row">
    <div class="tab-block mb25">
        <!-- ABAS SELECIONADAS -->
        <ul class="nav nav-tabs tabs-bg">
            <?php
            $urlBase = $this->url(ConstantesLancamento::$ROUTE_LANCAMENTO);
            $urlBase2 = $urlBase . '/2';
            ?>
            <li role="presentation" <?php echo ConstantesLancamento::$ONCLICK_ABRIR_MODAL; ?> <?php echo $this->abaSelecionada($this->abaSelecionada, 1); ?>><a href="<?php echo $urlBase; ?>"><i class="fa fa-wheelchair text-purple"></i> M&ecirc;s Atual</a></li>
            <li role="presentation" <?php echo ConstantesLancamento::$ONCLICK_ABRIR_MODAL; ?> <?php echo $this->abaSelecionada($this->abaSelecionada, 2); ?>><a href="<?php echo $urlBase2; ?>"><i class="fa fa-bolt text-purple"></i>M&ecirc;s Anterior</a></li>
        </ul>
        <!-- FIM ABAS SELECIONADAS -->
        <!-- MODAL COM LOADER GIGANTE -->
        <?php echo $this->modalAba(); ?>
        <!-- FIM MODAL COM LOADER GIGANTE -->
        <button class="btn btn-danger btn-lg" onclick="location.href = '/lancamentoCadastrarPessoa';" >NOVO CADSTRO</button>
        <div class="tab-content">
            <div id="tab10_1" class="tab-pane active">
                <div id="cabecalhoCiclo" class="row">
                    <div class="col-md-6">
                        Lista de lan√ßamento
                        <button class=" btn btn-success" >
                            <i class="fa fa-bolt text-purple"></i>
                        </button>
                    </div>
                    <div class="col-md-6 text-center">
                        <?php
                        $urlBaseCiclo = $urlBase . '/' . $this->abaSelecionada . '_';
                        if ($this->cicloSelecionado > 1) {
                            $urlCicloAnterior = $urlBaseCiclo . ($this->cicloSelecionado - 1);
                            ?>
                            <a <?php echo ConstantesLancamento::$ONCLICK_ABRIR_MODAL; ?> href="<?php echo $urlCicloAnterior; ?>"><i class="btn fa fa-angle-double-left text-purple"></i></a>
                            <?php
                        }
                        ?>    
                        Ciclo {<?php echo $this->cicloSelecionado; ?>}
                        <?php
                        $totalDeCiclos = FuncoesLancamento::totalCiclosMes($mesSelecionado, $anoSelecionado);
                        if ($this->cicloSelecionado < $totalDeCiclos) {
                            $urlCicloPosterior = $urlBaseCiclo . ($this->cicloSelecionado + 1);
                            ?>
                            <a <?php echo ConstantesLancamento::$ONCLICK_ABRIR_MODAL; ?> href="<?php echo $urlCicloPosterior; ?>"><i class="btn fa fa-angle-double-right text-purple"></i></a>
                            <?php
                        }
                        ?>
                    </div>
                </div>
                <div id="cabecalhoEventos" class="row">
                    <div class="col-md-6">
                        <input class="form-control" placeholder="Buscar nome" />
                    </div>
                    <div class="col-md-6 text-center">
                        {
                        <?php
                        /* Listagem dos eventos */
                        $grupo = $this->entidade->getGrupo();
                        $eventos = $grupo->getGrupoEventoNoCiclo($this->cicloSelecionado);
                        if (count($eventos) > 0) {
                            foreach ($eventos as $ge) {
                                /* Verificar se o evento existe nesse ciclo */
                                echo $ge->getEvento()->getEventoTipo()->getNome() . "|";
                                echo $ge->getEvento()->getDia() . "|";
                                echo $ge->getEvento()->getHora() . " - ";
                            }
                        }
                        ?>}
                    </div>
                </div>
                <div id="listaEventos" class="row">
                    <?php
                    if (count($grupo->getGrupoPessoa()) > 0) {
                        foreach ($grupo->getGrupoPessoa() as $gp) {
                            $pessoa = $gp->getPessoa();
                            $pessoaTipo = $gp->getGrupoPessoaTipo();
                            echo '<div class="row">';
                            echo '<div class="col-md-3 btn-success">' . $pessoa->getNome() . '</div>';
                            echo '<div class="col-md-2 btn-danger">' . $pessoaTipo->getNome() . '</div>';
                            echo '</div>';
                        }
                    }
                    ?>
                </div>
            </div>
            <div id="tab10_2" class="tab-pane">
                TAB 2
            </div>
        </div>
    </div>
</div>

<?php
/* Layout com javascript para tela de index */
echo $this->layoutJSLancamento;

//<?php
//echo "Nome: " . $pessoa->getNome() . "<br />";
//echo "Grupos { <br />";
//foreach ($pessoa->getResponsabilidadesAtivas() as $gr) {
//    $grupo = $gr->getGrupo();
//    echo "==== Entidade Nome: " . $grupo->getEntidadeAtiva()->getEntidadeTipo()->getNome() . "<br />";
//    echo "==== Entidade Info: " . $grupo->getEntidadeAtiva()->infoEntidade() . "<br />";
//    echo "==== | ==== Total de Eventos: " . count($grupo->getGrupoEvento()) . " <br />";
//
//    if (count($grupo->getGrupoEvento()) > 0) {
//        echo "LISTAGEM DE EVENTOS #################################<br />";
//        echo "==== | ==== Eventos { <br />";
//        foreach ($grupo->getGrupoEvento() as $ge) {
//            echo "==== | ==== | ==== Nome Tipo Evento " . $ge->getEvento()->getEventoTipo()->getNome() . "<br />";
//            echo "==== | ==== | ==== Dia " . $ge->getEvento()->getDia() . "<br />";
//            echo "==== | ==== | ==== Hora " . $ge->getEvento()->getHora() . "<br />";
//            if ($ge->getEvento()->getEventoTipo()->getId() == 1) {// celula
//                $celula = $ge->getEvento()->getEventoCelula();
//                echo "==== | ==== | ==== | ==== " . $celula->getNome_hospedeiro() . "<br />";
//                echo "==== | ==== | ==== | ==== " . $celula->getTelefone_hospedeiro() . "<br />";
//                echo "==== | ==== | ==== | ==== " . $celula->getLogradouro() . "<br />";
//                echo "==== | ==== | ==== | ==== " . $celula->getComplemento() . "<br />";
//            }
//        }
//        echo "==== | ==== } <br />";
//    }
//    if (count($grupo->getGrupoPessoa()) > 0) {
//        echo "LISTAGEM DE PESSOAS #################################<br />";
//        echo "==== | ==== Pessoas volateis { <br />";
//        foreach ($grupo->getGrupoPessoa() as $gp) {
//            $pessoa = $gp->getPessoa();
//            echo "==== | ==== | ==== Nome " . $pessoa->getNome() . "<br />";
//            $pessoaTipo = $gp->getGrupoPessoaTipo();
//            echo "==== | ==== | ==== | ==== Tipo " . $pessoaTipo->getNome() . "<br />";
//        }
//        echo "==== | ==== } <br />";
//    }
//}
//echo "} <br />";
