<?php

use Application\Controller\Helper\Constantes;

$html = '';
$pessoas = array();
$frequencias = $this->evento->getEventoFrequencia();

if (count($frequencias) > 0) {
    foreach ($frequencias as $frequencia) {
        $pessoa = $frequencia->getPessoa();
        if ($grupoRespossabilidades = $pessoa->getResponsabilidadesAtivas()) {
            $grupoRespossabilidades[0]->getGrupo()->getEntidadeAtiva()->infoEntidade();
            $pessoas[] = $pessoa;
        }
    }
}

/* Sem pessoas cadastrados */
if (count($pessoas) == 0) {
    $html .= '<div class="alert alert-warning"><i class="fa fa-warning pr10" aria-hidden="true"></i>&nbsp;Sem Líderes Cadastrados!</div>';
} else {

    $html .= $this->view->templateFormularioTopo('Listagem de Líderes para o Revisão de Vidas');
    $html .= '<div class="panel-body bg-light">';

    $html .= '<table class="table">';
    $html .= '<thead>';
    $html .= '<tr>';

    $html .= '<th class="text-center">';
    $html .= $this->view->translate(Constantes::$TRADUCAO_MATRICULA);
    $html .= '</th>';
    $html .= '<th class="text-center">';
    $html .= $this->view->translate(Constantes::$TRADUCAO_NOME);
    $html .= '</th>';

    $html .= '<th class="text-center">Equipe</th>';

    $html .= '<th class="text-center"></th>';
    $html .= '</tr>';
    $html .= '</thead>';
    $html .= '<tbody>';

    foreach ($pessoas as $pessoa) {
        $html .= '<tr>';

        $html .= '<td class="text-center">' . $pessoa->getId() . '</td>';

        $html .= '<td class="text-center"><span class="visible-lg visible-md">' . $pessoa->getNome() . '</span><span class="visible-sm visible-xs">' . $pessoa->getNomePrimeiroUltimo() . '</span></td>';

        $html .= '<td class="text-center">' . $pessoa->getResponsabilidadesAtivas()[0]->getGrupo()->getEntidadeAtiva()->infoEntidade() . '</td>';

        $html .= '</tr>';
    }
    $html .= '</tbody>';
    $html .= '</table>';

    $html .= '</div>';
    /* Fim panel-body */
    $html .= '<div class="panel-footer text-right">';

    $stringNomeDaFuncaoOnClickCadastro = 'funcaoCadastro("' . Constantes::$PAGINA_FICHA_REVISIONISTAS . '", ' . $pessoa->getId() . ')';
    $html .= $this->view->botaoLink($this->view->translate(Constantes::$TRADUCAO_VOLTAR), Constantes::$STRING_HASHTAG, 0, $this->view->funcaoOnClick($stringNomeDaFuncaoOnClickCadastro));

    /* Fim Botões */
    $html .= '</div>';
    /* Fim panel-footer */
    $html .= $this->templateFormularioRodape();
}

echo $html;
echo $this->layoutJSEventosValidacao;
