<?php

use Application\Controller\Helper\Constantes;
use Application\Model\Entity\EntidadeTipo;
use Application\Model\Entity\Situacao;
use Application\Model\Entity\SolicitacaoTipo;
use Application\Controller\Helper\Funcoes;

$html = '';
$html .= $this->templateFormularioTopo($this->titulo);
$html .= '<div class="panel-body bg-light">';
foreach($this->solicitacoesTipo as $solicitacaoTipo){
	$colspan = 0;
	$htmlThead = '';
	$htmlThead .= '<th class="hidden-xs">Solicitado em</th>';
	switch($solicitacaoTipo->getId()){
	case SolicitacaoTipo::TRANSFERIR_LIDER_NA_PROPRIA_EQUIPE:
		$colspan = 6;
		$htmlThead .= '<th>Time</th>';
		$htmlThead .= '<th>Quem</th>';
		$htmlThead .= '<th>Novo Time</th>';
		$htmlThead .= '<th>Novo Líder</th>';
		break;
	case SolicitacaoTipo::REMOVER_LIDER:
		$colspan = 4;
		$htmlThead .= '<th>Time</th>';
		$htmlThead .= '<th>Quem</th>';
		break;
	case SolicitacaoTipo::REMOVER_CELULA:
		$colspan = 5;
		$htmlThead .= '<th>Time</th>';
		$htmlThead .= '<th>Quem</th>';
		$htmlThead .= '<th>Célula</th>';
	}
	$htmlThead .= '<th>Status</th>';

	$html .= '<table style="font-size:10px;" class="table table-condensed table-hover bg-light mt15 footable" data-filter="#fooFilter">';
	$html .= '<thead>';

	$html .= '<tr>';
	$html .= '<th colspan="'.$colspan.'">'.$solicitacaoTipo->getNome().'</th>';
	$html .= '</tr>';

	$html .= '<tr>';
	$html .= $htmlThead;
	$html .= '</tr>';

	$html .= '</thead>';

	$html .= '<tbody>';

	foreach ($this->solicitacoes[$solicitacaoTipo->getId()] as $solicitacao) {
		$objeto = $solicitacao->getObjeto1();
		$grupo = $this->repositorio->getGrupoORM()->encontrarPorId($objeto);

		$html .= '<tr>';
		$htmlTbody = '';
		$htmlTbody .= '<td class="hidden-xs">'.$solicitacao->getData_criacaoStringPadraoBrasil().'</td>';
		$htmlTbody .= '<td>'.$grupo->getGrupoEquipe()->getEntidadeAtiva()->getNome().'</td>';
		$htmlTbody .= '<td>'.$grupo->getNomeLideresAtivos().'</td>';

		switch($solicitacaoTipo->getId()){
		case SolicitacaoTipo::TRANSFERIR_LIDER_NA_PROPRIA_EQUIPE:
			$objeto2 = $solicitacao->getObjeto2();
			$grupo2 = $this->repositorio->getGrupoORM()->encontrarPorId($objeto2);

			$htmlTbody .= '<td>'.$grupo2->getGrupoEquipe()->getEntidadeAtiva()->getNome().'</td>';
			$htmlTbody .= '<td>'.$grupo2->getNomeLideresAtivos().'</td>';

			break;
		case SolicitacaoTipo::REMOVER_CELULA:
			$objeto = $solicitacao->getObjeto2();
			$grupoEvento = $this->repositorio->getGrupoEventoORM()->encontrarPorId($objeto);
			$htmlCelula = $this->translate(Funcoes::diaDaSemanaPorDia($grupoEvento->getEvento()->getDia(),1)).' - ' . $grupoEvento->getEvento()->getHora() . ' - Hospedeiro: '.$grupoEvento->getEvento()->getEventoCelula()->getNome_hospedeiro(). ' Local: ' . $grupoEvento->getEvento()->getEventoCelula()->getLogradouro().' '.$grupoEvento->getEvento()->getEventoCelula()->getComplemento();
			$htmlTbody .= '<td>'.$htmlCelula.'</td>';
		}
		$htmlTbody .= '<td>'.$solicitacao->getSolicitacaoSituacaoAtiva()->getSituacao()->getNome().'</td>';

		$html .= $htmlTbody;
		$html .= '</tr>';
	}
	$html .= '</tbody>';
	$html .= '</table>';
}
$html .= '</div>';

$html .= '<div class="panel-footer text-right">';
$stringNomeDaFuncaoOnClickCadastro = 'funcaoCircuito("cadastroSolicitacao", 0)';
$html .= $this->botaoLink($this->translate(Constantes::$TRADUCAO_CADASTRAR), Constantes::$STRING_HASHTAG, 0, $this->funcaoOnClick($stringNomeDaFuncaoOnClickCadastro));
$html .= '</div>';

$html .= $this->templateFormularioRodape();
echo $html;

