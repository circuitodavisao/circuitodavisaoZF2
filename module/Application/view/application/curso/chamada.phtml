<?php

use Application\Model\Entity\EntidadeTipo;
use Application\View\Helper\BotaoSimples;

$html = '';
$html .= '<div class="panel heading-border panel-primary">';
$html .= '<div class="panel-body bg-light">';

foreach ($this->turmas as $turma) {
    $html .= '<table class="table table-bordered table-condensed">';

    $html .= '<thead>';
    $html .= '<tr>';
    $html .= '<th colspan="2" class="text-center">' . $turma->getCurso()->getNome() . ' - ' . str_pad($turma->getMes(), 2, 0, STR_PAD_LEFT) . '/' . $turma->getAno() . '</th>';
    foreach ($turma->getCurso()->getDisciplina() as $disciplina) {
        $html .= '<th colspan="' . count($disciplina->getAula()) . '" class="text-center">' . $disciplina->getNome() . '</th>';
    }
    $html .= '</tr>';
    $html .= '<tr>';
    $html .= '<th class="text-center">Matricula</th>';
    $html .= '<th class="text-center">Aluno</th>';
    foreach ($turma->getCurso()->getDisciplina() as $disciplina) {
        foreach ($disciplina->getAula() as $aula) {
            $html .= '<th class="text-center">A' . $aula->getPosicao() . '</th>';
        }
    }
    $html .= '</tr>';


    $html .= '</thead>';

    $html .= '<tbody>';
    if ($turma->getTurmaPessoa()) {
        foreach ($turma->getTurmaPessoa() as $turmaPessoa) {
            $mostrar = false;
            if ($this->entidade->getEntidadeTipo()->getId() === EntidadeTipo::igreja ||
                    $this->entidade->getEntidadeTipo()->getId() === EntidadeTipo::equipe) {

                if ($this->entidade->getEntidadeTipo()->getId() === EntidadeTipo::igreja) {
                    $mostrar = true;
                }
                if ($this->entidade->getEntidadeTipo()->getId() === EntidadeTipo::equipe) {
                    if ($turmaPessoa->getPessoa()->getGrupoPessoa()[0]->getGrupo()->getEntidadeAtiva()->getGrupoEquipe() === $this->entidade->getId()) {
                        $mostrar = true;
                    }
                }
            } else {
                foreach ($this->grupoPessoas as $grupoPessoa) {
                    if ($grupoPessoa->getPessoa()->getId() === $turmaPessoa->getPessoa()->getId()) {
                        $mostrar = true;
                        break;
                    }
                }
            }

            if ($mostrar) {
                $html .= '<tr>';
                $html .= '<td>' . str_pad($turmaPessoa->getId(), 8, 0, STR_PAD_LEFT) . '</td>';
                $html .= '<td>' . $turmaPessoa->getPessoa()->getNome() . '</td>';
                foreach ($turma->getCurso()->getDisciplina() as $disciplina) {
                    foreach ($disciplina->getAula() as $aula) {
                        $frequencia = false;
                        $icone = 'fa-thumbs-down';
                        $corDoBotao = BotaoSimples::botaoMuitoPequenoPerigoso;
                        $html .= '<td class="text-center">';
                        if (count($turmaPessoa->getTurmaPessoaAula()) > 0) {
                            foreach ($turmaPessoa->getTurmaPessoaAula() as $turmaPessoaAula) {
                                if ($turmaPessoaAula->getAula()->getId() === $aula->getId()) {
                                    $frequencia = true;
                                    $icone = 'fa-thumbs-up';
                                    $corDoBotao = BotaoSimples::botaoMuitoPequenoImportante;
                                }
                            }
                        }
                        $iconeBotao = '<i class="fa ' . $icone . '"></i>';
                        $extra = ' disabled ';
                        $html .= $this->botaoSimples($iconeBotao, $extra, $corDoBotao, BotaoSimples::posicaoAoCentro);
                        $html .= '</td>';
                    }
                }
                $html .= '</tr>';
            }
        }
    }

    $html .= '</tbody>';

    $html .= '</table>';
}
$html .= '</div>';
$html .= '</div>';

echo $html;
