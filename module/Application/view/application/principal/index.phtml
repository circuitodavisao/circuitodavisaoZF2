<?php

use Application\Controller\RelatorioController;
?>
<!-- Begin: Content -->
<section id="content" class="table-layout animated fadeIn">


    <!-- begin: .tray-center -->
    <div class="tray tray-center">

        <?php echo $this->dadosPrincipal(); ?>

        <div class="">
            <!--<div class="admin-panels fade-onload">-->
            <div class="row">
                <div class="col-md-12">
                    <div class="panel sort-disable" data-panel-title="false">
                        <div class="panel-heading">
                            <span class="panel-icon">
                                <i class="fa fa-bar-chart"></i>
                            </span>
                            <span class="panel-title"><?php echo $this->periodoExtenso; ?></span>
                        </div>
                        <div class="panel-body pn">
                            <table class="table table-condensed mbn">
                                <tbody>
                                    <tr>
                                        <td>Membresia</td>
                                        <td>Meta <?php echo $this->relatorio['membresiaMeta']; ?></td>
                                        <td>
                                            <span class="label label-<?php echo $this->relatorio['membresiaPerformanceClass']; ?>">
                                                <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresia']); ?>
                                            </span>
                                        </td>
                                        <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorioEquipe['membresiaPerformance']); ?>%</td>
                                        <td><button onclick="$('#div1').toggleClass('hidden');" class="btn btn-xs btn-primary"><i class="fa fa-caret-down"></i></button></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="div1" class="row p10 hidden">
                                <div class="panel">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-xs-4 text-center">
                                                <h3>Culto</h3>
                                                <h4>Meta <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresiaMeta'] / 2); ?></h4>
                                            </div>
                                            <div class="col-xs-4 text-center">
                                                <h3>Arena</h3>
                                                <h4>Meta <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresiaMeta'] / 2); ?></h4>
                                            </div>
                                            <div class="col-xs-4 text-center">
                                                <h3>Domingo</h3>
                                                <h4>Meta <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresiaMeta'] / 2); ?></h4>
                                            </div>
                                        </div>
                                        <?php
                                        $perfomance = array();
                                        $perfomance['culto'] = $this->relatorio['membresiaCulto'] / $this->relatorio['membresiaMeta'] * 100;
                                        $perfomance['arena'] = $this->relatorio['membresiaArena'] / $this->relatorio['membresiaMeta'] * 100;
                                        $perfomance['domingo'] = $this->relatorio['membresiaDomingo'] / $this->relatorio['membresiaMeta'] * 100;
                                        ?>
                                        <div class="row">
                                            <div class="col-xs-4 text-center">
                                                <div class="ib">
                                                    <div class="progress vertical bottom progress-bar-lg mt10 mbn">
                                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="<?php echo $this->relatorio['membresiaCulto']; ?>" aria-valuemin="0" aria-valuemax="<?php echo $this->relatorio['membresiaMeta']; ?>" style="height: <?php echo $perfomance['culto']; ?>%;"><?php echo $this->relatorio['membresiaCulto']; ?></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-4 text-center">
                                                <div class="ib">
                                                    <div class="progress vertical bottom progress-bar-lg mt10 mbn">
                                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="<?php echo $this->relatorio['membresiaArena']; ?>" aria-valuemin="0" aria-valuemax="<?php echo $this->relatorio['membresiaMeta']; ?>" style="height: <?php echo $perfomance['arena']; ?>%;"><?php echo $this->relatorio['membresiaArena']; ?></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-4 text-center">
                                                <div class="ib">
                                                    <div class="progress vertical bottom progress-bar-lg mt10 mbn">
                                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="<?php echo $this->relatorio['membresiaDomingo']; ?>" aria-valuemin="0" aria-valuemax="<?php echo $this->relatorio['membresiaMeta']; ?>" style="height: <?php echo $perfomance['domingo']; ?>%;"><?php echo $this->relatorio['membresiaDomingo']; ?></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt10">
                                            <div class="panel">
                                                <div class="panel-body pn text-center">
                                                    <h1>Cálculo da Membresia</h1>
                                                    <table class="table table-condensed">
                                                        <tbody>
                                                            <tr>
                                                                <td>(Culto/3)</td>
                                                                <td>+</td>
                                                                <td>(Arena/2)</td>
                                                                <td>+</td>
                                                                <td>Domingo</td>
                                                                <td>=</td>
                                                                <td>Memb.</td>
                                                            </tr>
                                                            <tr>
                                                                <td>(<?php echo $this->relatorio['membresiaCulto']; ?>/3)</td>
                                                                <td>+</td>
                                                                <td>(<?php echo $this->relatorio['membresiaArena']; ?>/2)</td>
                                                                <td>+</td>
                                                                <td><?php echo $this->relatorio['membresiaDomingo']; ?></td>
                                                                <td>=</td>
                                                                <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresia']); ?></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt10">
                                            <div class="col-sm-4 col-xl-4">
                                                <div class="panel panel-tile text-center br-a br-grey">
                                                    <div class="panel-body">
                                                        <h1 class="fs30 mt5 mbn"><?php echo $this->relatorio['membresiaCulto']; ?></h1>
                                                        <h6 class="text-system">CULTO</h6>
                                                    </div>
                                                    <div class="panel-footer br-t p12">
                                                        <span class="fs11">
                                                            <i class="fa fa-arrow-<?php echo $this->relatorio['diferencaCultoSeta']; ?> pr5"></i> <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['diferencaCulto']); ?>% <?php echo $this->relatorio['diferencaCultoFrase']; ?>
                                                            <b>1 SEMANA ATRÁS</b>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4 col-xl-4">
                                                <div class="panel panel-tile text-center br-a br-grey">
                                                    <div class="panel-body">
                                                        <h1 class="fs30 mt5 mbn"><?php echo $this->relatorio['membresiaArena']; ?></h1>
                                                        <h6 class="text-system">ARENA</h6>
                                                    </div>
                                                    <div class="panel-footer br-t p12">
                                                        <span class="fs11">
                                                            <i class="fa fa-arrow-<?php echo $this->relatorio['diferencaArenaSeta']; ?> pr5"></i> <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['diferencaArena']); ?>% <?php echo $this->relatorio['diferencaArenaFrase']; ?>
                                                            <b>1 SEMANA ATRÁS</b>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4 col-xl-4">
                                                <div class="panel panel-tile text-center br-a br-grey">
                                                    <div class="panel-body">
                                                        <h1 class="fs30 mt5 mbn"><?php echo $this->relatorio['membresiaDomingo']; ?></h1>
                                                        <h6 class="text-system">DOMINGO</h6>
                                                    </div>
                                                    <div class="panel-footer br-t p12">
                                                        <span class="fs11">
                                                            <i class="fa fa-arrow-<?php echo $this->relatorio['diferencaDomingoSeta']; ?> pr5"></i> <?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['diferencaDomingo']); ?>% <?php echo $this->relatorio['diferencaDomingoFrase']; ?>
                                                            <b>1 SEMANA ATRÁS</b>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--                <div class="col-md-12">
                                    <div class="panel" data-panel-title="false">
                                        <div class="panel-heading">
                                            <span class="panel-icon">
                                                <i class="fa fa-line-chart"></i>
                                            </span>
                                            <span class="panel-title"> Proximo Nível</span>
                                        </div>
                                        <div class="panel-body pn">
                
                                            <div class="row p15">
                                                <div class="col-xs-3">
                                                    <b>Obreiro</b>
                                                </div>  
                                                <div class="col-xs-9">
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">60%</div>
                                                    </div>
                                                </div> 
                                            </div>               
                                        </div>
                                    </div>
                                </div>-->
            </div>
        </div>
        <h1 class="text-center">Antigo Relatório embaixo <i class="fa fa-arrow-down pr5"></i></h1>

    </div>  
</section>

<div class="mw800 center-block">
    <div class="panel">
        <div class="panel-heading text-center">
            <span class="panel-title"><b>Supervis&atilde;o - <?php echo $this->periodoExtenso; ?></b></span>
        </div>
        <div class="panel-body pn">
            <table class="table mbn tc-med-1 tc-bold-last">
                <?php
                if ($this->discipulos) {
                    $html = '';
                    $totalDeCelulasNaoRealizadas = 0;
                    foreach ($this->discipulos as $gpFilho) {
                        $grupoFilho = $gpFilho->getGrupoPaiFilhoFilho();
                        $nomeLideres = $grupoFilho->getNomeLideresAtivos();
                        $relatorioDiscipulo = $this->discipulosRelatorio[$grupoFilho->getId()];
                        $relatorioDiscipuloPessoal = $this->discipulosRelatorioPessoal[$grupoFilho->getId()];
                        $diferenca = $relatorioDiscipulo['celulaQuantidade'] - $relatorioDiscipulo['celulaRealizadas'];
                        $diferencaPessoal = $relatorioDiscipuloPessoal['celulaQuantidade'] - $relatorioDiscipuloPessoal['celulaRealizadas'];
                        $html .= '<tr class="dark">';
                        $html .= '<td>EQUIPE - ' . $nomeLideres . '</td>';
                        $html .= '<td></td>';
                        $html .= '</tr>';
                        if ($diferencaPessoal > 0) {
                            $html .= '<tr>';
                            $html .= '<td class="text-right">' . $nomeLideres . '</td>';
                            $html .= '<td>' . $diferencaPessoal . '</td>';
                            $html .= '</tr>';
                        }
                        $grupoPaiFilhoFilhos144 = $grupoFilho->getGrupoPaiFilhoFilhosAtivos(-1);
                        if ($grupoPaiFilhoFilhos144) {
                            foreach ($grupoPaiFilhoFilhos144 as $gpFilho144) {
                                $grupoFilho144 = $gpFilho144->getGrupoPaiFilhoFilho();
                                $nomeLideres144 = $grupoFilho144->getNomeLideresAtivos();
                                $relatorioDiscipulo144 = $this->discipulosRelatorio[$grupoFilho144->getId()];
                                if ($relatorioDiscipulo144) {
                                    $diferenca144 = $relatorioDiscipulo144['celulaQuantidade'] - $relatorioDiscipulo144['celulaRealizadas'];
                                    $html .= '<tr>';
                                    $html .= '<td class="text-right">' . $nomeLideres144 . '</td>';
                                    $html .= '<td>' . $diferenca144 . '</td>';
                                    $html .= '</tr>';
                                }
                            }
                        }
                        $html .= '<tr class="">';
                        $html .= '<td class="text-right">TOTAL</td>';
                        $html .= '<td>' . $diferenca . '</td>';
                        $html .= '</tr>';
                        $html .= '<tr>';
                        $html .= '<td colspan="2"></td>';
                        $html .= '</tr>';
                        $totalDeCelulasNaoRealizadas += $diferenca;
                    }
                    echo '<tr>';
                    echo '<td colspan="3" class="text-center">Celulas <b>N&atilde;o</b> Realizadas: ' . $totalDeCelulasNaoRealizadas . '</td>';
                    echo '</tr>';
                    echo $html;
                }
                ?>
            </table>
        </div>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <span class="panel-title">Pessoal</span>
        </div>
        <div class="panel-body pn">
            <table class="table mbn tc-med-1 tc-bold-last">
                <tr>
                    <td></td>
                    <td>Meta</td>
                    <td>Valor</td>
                    <td>Perf.%</td>
                </tr>
                <tr class="<?php echo $this->relatorio['membresiaPerformanceClass']; ?>">
                    <td>Membresia</td>
                    <td><?php echo $this->relatorio['membresiaMeta']; ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresia']); ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['membresiaPerformance']); ?>%</td>
                </tr>
                <tr class="<?php echo $this->relatorio['celulaPerformanceClass']; ?>">
                    <td>Célula</td>
                    <td><?php echo $this->relatorio['membresiaMeta']; ?></td>
                    <td><?php echo $this->relatorio['celula']; ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['celulaPerformance']); ?>%</td>
                </tr>
                <tr class="<?php echo $this->relatorio['celulaRealizadasPerformanceClass']; ?>">
                    <td>Cél. Realizadas</td>
                    <td><?php echo $this->relatorio['celulaQuantidade']; ?></td>
                    <td><?php echo $this->relatorio['celulaRealizadas']; ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorio['celulaRealizadasPerformance']); ?>%</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <span class="panel-title">Equipe</span>
        </div>
        <div class="panel-body pn">
            <table class="table mbn tc-med-1 tc-bold-last">
                <tr>
                    <td></td>
                    <td>Meta</td>
                    <td>Valor</td>
                    <td>Perf.%</td>
                </tr>
                <tr class="<?php echo $this->relatorioEquipe['membresiaPerformanceClass']; ?>">
                    <td>Membresia</td>
                    <td><?php echo $this->relatorioEquipe['membresiaMeta']; ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorioEquipe['membresia']); ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorioEquipe['membresiaPerformance']); ?>%</td>
                </tr>
                <tr class="<?php echo $this->relatorioEquipe['celulaPerformanceClass']; ?>">
                    <td>Célula</td>
                    <td><?php echo $this->relatorioEquipe['membresiaMeta']; ?></td>
                    <td><?php echo $this->relatorioEquipe['celula']; ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorioEquipe['celulaPerformance']); ?>%</td>
                </tr>
                <tr class="<?php echo $this->relatorioEquipe['celulaRealizadasPerformanceClass']; ?>">
                    <td>Cél. Realizadas</td>
                    <td><?php echo $this->relatorioEquipe['celulaQuantidade']; ?></td>
                    <td><?php echo $this->relatorioEquipe['celulaRealizadas']; ?></td>
                    <td><?php echo RelatorioController::formataNumeroRelatorio($this->relatorioEquipe['celulaRealizadasPerformance']); ?>%</td>
                </tr>
            </table>
        </div>
    </div>        
</div>

<?php
echo $this->layoutJSPrincipal;
