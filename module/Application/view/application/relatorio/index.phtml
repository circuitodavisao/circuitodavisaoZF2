<?php

use Application\Controller\Helper\Constantes;
use Application\Controller\Helper\Funcoes;
use Application\Controller\RelatorioController;

$dimensaoTipoCelula = 1;
$dimensaoTipoCulto = 2;
$dimensaoTipoArena = 3;
$dimensaoTipoDomingo = 4;

$somaGeral[1] = 0;
$somaGeral[2] = 0;
$somaGeral[3] = 0;
$somaGeral[4] = 0;
$somaGeralLideres = 0;
$somaQuantidadeCelulas = 0;
$somaQuantidadeCelulasRealizadas = 0;
$somaQuantidadeCelulasDeElite = 0;
$somaMedia = array();
$somaLideres = 0;
$somaMeta = 0;
?>
<style type="text/css">
    th {
        text-align: center;
    }
    .table-condensed>tbody>tr>td, .table-condensed>tbody>tr>th, .table-condensed>tfoot>tr>td, .table-condensed>tfoot>tr>th, .table-condensed>thead>tr>td, .table-condensed>thead>tr>th {
        padding: 0px;
    }
</style>
<div class="center-block">
    <div class="panel-body bg-light">  
        <div class="panel">
            <div class="panel-heading">             
                <?php echo $this->cabecalhoDeMeses(); ?>
            </div>
            <div class="panel-body pn">
                <?php
                if ($this->tipoRelatorio == 1) {
                    $label = 'Membresia';
                }
                if ($this->tipoRelatorio == 2) {
                    $label = 'Células Realizadas';
                }
                if ($this->tipoRelatorio == 3) {
                    $label = 'Células Quantitativo';
                }
                if ($this->tipoRelatorio == 4) {
                    $label = 'Culto da Semana';
                }
                if ($this->tipoRelatorio == 5) {
                    $label = 'Arena';
                }
                if ($this->tipoRelatorio == 6) {
                    $label = 'Domingo';
                }
                if ($this->tipoRelatorio == 7) {
                    $label = 'C&eacute;lula/Arena';
                }
                if ($this->tipoRelatorio == 8) {
                    $label = 'C&eacute;lula de Elite';
                }
                echo '<div class="alert alert-default text-center mt10">' . $label . '</div>';
                ?>
                <table class="text-center table table-condensed table-hover bg-light" style="font-size:10px;">
                    <thead>
                        <tr class="dark">
                            <?php
                            if ($this->tipoRelatorio != 7) {
                                echo '<th></th>';
                            }
                            echo '<th>Periodos</th>';
                            echo '<th>|</th>';
                            for ($indiceDeArrays = $this->periodoInicial; $indiceDeArrays <= $this->periodoFinal; $indiceDeArrays++) {
                                $classePeriodoAtual = '';
                                if ($indiceDeArrays == -1) {
                                    $classePeriodoAtual = 'class="bg-primary"';
                                }
                                if ($this->tipoRelatorio == 1) {
                                    $colspan = 7;
                                }
                                if ($this->tipoRelatorio == 2 ||
                                        $this->tipoRelatorio == 7) {
                                    $colspan = 3;
                                }
                                if ($this->tipoRelatorio == 3 ||
                                        $this->tipoRelatorio == 8) {
                                    $colspan = 4;
                                }
                                if ($this->tipoRelatorio == 4 ||
                                        $this->tipoRelatorio == 5 ||
                                        $this->tipoRelatorio == 6) {
                                    $colspan = 2;
                                }
                                echo '<th colspan="' . $colspan . '" ' . $classePeriodoAtual . '>' . Funcoes::montaPeriodo($indiceDeArrays)[0] . '</th>';
                                echo '<th>|</th>';
                            }
                            echo '<th colspan="2"></th>';
                            ?>                           
                        </tr>
                        <tr class="dark">
                            <?php
                            if ($this->tipoRelatorio != 7) {
                                echo '<th>#</th>';
                            }
                            echo '<th>TIMES</th>';
                            echo '<th>|</th>';
                            for ($indiceDeArrays = $this->periodoInicial; $indiceDeArrays <= $this->periodoFinal; $indiceDeArrays++) {
                                $classePeriodoAtual = '';
                                if ($indiceDeArrays == -1) {
                                    $classePeriodoAtual = 'bg-primary';
                                }
                                if ($this->tipoRelatorio == 1) {
                                    echo '<th class="hidden-xs ' . $classePeriodoAtual . '">LID</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">MET</th>';

                                    echo '<th class = "hidden-xs ' . $classePeriodoAtual . '">CUL</th>';
                                    echo '<th class = "hidden-xs ' . $classePeriodoAtual . '">ARE</th>';
                                    echo '<th class = "hidden-xs ' . $classePeriodoAtual . '">DOM</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">MEM</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">%</th>';
                                }
                                if ($this->tipoRelatorio == 7) {
                                    echo '<th class="' . $classePeriodoAtual . '">META</th>';
                                }
                                if ($this->tipoRelatorio == 2 ||
                                        $this->tipoRelatorio == 7 ||
                                        $this->tipoRelatorio == 8) {
                                    echo '<th class="' . $classePeriodoAtual . '">CÉLULAS</th>';
                                }
                                if ($this->tipoRelatorio == 2) {
                                    echo '<th class="' . $classePeriodoAtual . '">REALIZADAS</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">%</th>';
                                }
                                if ($this->tipoRelatorio == 3) {
                                    echo '<th class="hidden-xs ' . $classePeriodoAtual . '">LID</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">MET</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">QTD</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">%</th>';
                                }
                                if ($this->tipoRelatorio == 4 ||
                                        $this->tipoRelatorio == 5 ||
                                        $this->tipoRelatorio == 6) {
                                    echo '<th class="' . $classePeriodoAtual . '">LID</th>';
                                }
                                if ($this->tipoRelatorio == 7) {
                                    echo '<th class="' . $classePeriodoAtual . '">ARENA</th>';
                                }
                                if ($this->tipoRelatorio == 8) {
                                    echo '<th class="' . $classePeriodoAtual . '">ELITE</th>';
                                    echo '<th class="' . $classePeriodoAtual . '">%</th>';
                                }
                                if ($this->tipoRelatorio == 4 ||
                                        $this->tipoRelatorio == 5 ||
                                        $this->tipoRelatorio == 6 ||
                                        $this->tipoRelatorio == 8) {
                                    echo '<th class="' . $classePeriodoAtual . '">QTD</th>';
                                }
                                echo '<th>|</th>';
                            }
                            if ($this->tipoRelatorio == 1 ||
                                    $this->tipoRelatorio == 2 ||
                                    $this->tipoRelatorio == 3) {
                                echo '<th colspan="2">MÉDIA MENSAL</th>';
                            }
                            ?>                           
                        </tr>
                    </thead>
                    <tbody>
                        <?php
                        $contagemRanking = 0;
                        $totalDeRelatorios = count($this->relatorio);
                        foreach ($this->relatorio as $relatorio) {
                            $corLinha = '';
                            if ($relatorio['lideres'] == 'TOTAL') {
                                $corLinha = 'dark';
                            }
                            if ($contagemRanking !== 0 && $contagemRanking !== ($totalDeRelatorios - 1)) {
                                if ($this->tipoRelatorio == 1) {
                                    $corLinha = $relatorio['mediaMembresiaPerformanceClass'];
                                }
                                if ($this->tipoRelatorio == 2) {
                                    $corLinha = $relatorio['mediaCelulaRealizadasPerformanceClass'];
                                }
                                if ($this->tipoRelatorio == 3) {
                                    $corLinha = $relatorio['mediaCelulaPerformanceClass'];
                                }
                                if ($this->tipoRelatorio == 8) {
                                    $corLinha = $relatorio['celulaDeElitePerformanceClass'];
                                }
                            }
                            echo '<tr class="' . $corLinha . '">';
                            if ($this->tipoRelatorio != 7) {
                                $label = '';
                                if ($contagemRanking !== 0 && $contagemRanking !== ($totalDeRelatorios - 1)) {
                                    $label = $contagemRanking;
                                }
                                echo '<td>' . $label . '</td>';
                            }
                            echo '<td class="text-left">' . $relatorio['lideres'] . '</td>';
                            echo '<td>|</td>';
                            for ($indiceDeArrays = $this->periodoInicial; $indiceDeArrays <= $this->periodoFinal; $indiceDeArrays++) {
                                if ($this->tipoRelatorio == 1) {
                                    echo '<td class = "hidden-xs">' . $relatorio[$indiceDeArrays]['quantidadeLideres'] . '</td>';
                                    echo '<td>' . $relatorio[$indiceDeArrays]['membresiaMeta'] . '</td>';
                                    echo '<td class = "hidden-xs">' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['membresiaCulto']) . '</td>';
                                    echo '<td class = "hidden-xs">' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['membresiaArena']) . '</td>';
                                    echo '<td class = "hidden-xs">' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['membresiaDomingo']) . '</td>';
                                    echo '<td>' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['membresia']) . '</td>';
                                    echo '<td>' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['membresiaPerformance']) . '%</td>';
                                }
                                if ($this->tipoRelatorio == 2 ||
                                        $this->tipoRelatorio == 8) {
                                    echo '<td>' . $relatorio[$indiceDeArrays]['celulaQuantidade'] . '</td>';
                                }
                                if ($this->tipoRelatorio == 2) {
                                    echo '<td>' . $relatorio[$indiceDeArrays]['celulaRealizadas'] . '</td>';
                                    echo '<td>' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['celulaRealizadasPerformance']) . '%</td>';
                                }
                                if ($this->tipoRelatorio == 3) {
                                    echo '<td class = "hidden-xs">' . $relatorio[$indiceDeArrays]['quantidadeLideres'] . '</td>';
                                    echo '<td>' . $relatorio[$indiceDeArrays]['membresiaMeta'] . '</td>';
                                    echo '<td>' . $relatorio[$indiceDeArrays]['celula'] . '</td>';
                                    echo '<td>' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['celulaPerformance']) . '%</td>';
                                }
                                if ($this->tipoRelatorio == 4 ||
                                        $this->tipoRelatorio == 5 ||
                                        $this->tipoRelatorio == 6) {
                                    $quantidade = 0;
                                    switch ($this->tipoRelatorio) {
                                        case 4:
                                            $quantidade = $relatorio[$indiceDeArrays]['membresiaCulto'];
                                            break;
                                        case 5:
                                            $quantidade = $relatorio[$indiceDeArrays]['membresiaArena'];
                                            break;
                                        case 6:
                                            $quantidade = $relatorio[$indiceDeArrays]['membresiaDomingo'];
                                            break;
                                    }
                                    echo '<td>' . $relatorio[$indiceDeArrays]['quantidadeLideres'] . '</td>';
                                    echo '<td>' . RelatorioController::formataNumeroRelatorio($quantidade) . '</td>';
                                }
                                if ($this->tipoRelatorio == 7) {
                                    echo '<td>' . $relatorio[$indiceDeArrays]['membresiaMeta'] . '</td>';
                                    echo '<td>' . $relatorio[$indiceDeArrays]['celula'] . '</td>';
                                    echo '<td class = "hidden-xs">' . RelatorioController::formataNumeroRelatorio($relatorio[$indiceDeArrays]['membresiaArena']) . '</td>';
                                }
                                if ($this->tipoRelatorio == 8) {
                                    echo '<td>' . $relatorio[$indiceDeArrays]['celulaDeElite'] . '</td>';
                                    echo '<th>' . $relatorio[$indiceDeArrays]['celulaDeElitePerformance'] . '%</th>';
                                }
                                if ($this->tipoRelatorio == 8) {
                                    echo '<td>' . $relatorio[$indiceDeArrays]['celula'] . '</td>';
                                }
                                echo '<td>|</td>';
                            }

                            if ($this->tipoRelatorio == 1 ||
                                    $this->tipoRelatorio == 2 ||
                                    $this->tipoRelatorio == 3) {
                                if ($this->tipoRelatorio == 1) {
                                    $valorMedio = $relatorio['mediaMembresia'];
                                    $perfomanceMedio = $relatorio['mediaMembresiaPerformance'];
                                }
                                if ($this->tipoRelatorio == 2) {
                                    $valorMedio = $relatorio['mediaCelulaRealizadas'];
                                    $perfomanceMedio = $relatorio['mediaCelulaRealizadasPerformance'];
                                }
                                if ($this->tipoRelatorio == 3) {
                                    $valorMedio = $relatorio['mediaCelula'];
                                    $perfomanceMedio = $relatorio['mediaCelulaPerformance'];
                                }
                                echo '<td>' . RelatorioController::formataNumeroRelatorio($valorMedio) . '</td>';
                                echo '<td>' . RelatorioController::formataNumeroRelatorio($perfomanceMedio) . '%</td>';
                            }
                            echo '</tr>';
                            $contagemRanking++;
                        }
                        ?>                     
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>