<?php

use Application\Controller\Helper\Constantes;
$formulario = $this->formulario;
$formulario->prepare();
$formulario->setAttribute(Constantes::$ACTION, $this->url(Constantes::$ROUTE_LANCAMENTO, array(Constantes::$ACTION => 'parceiroDeDeusFinalizar')));
echo $this->form()->openTag($formulario); 
?>
<div class="panel-body bg-light text-center mt50">
	<h1>Parceiro de Deus</h1>
<?php 
echo $this->divMensagens();
?>
	<div class="form-group col-lg-12 col-md-12 col-sm-12 col-xs-12">
<label class="field-label text-muted fs18 mb10">Selecione o líder</label>
	<select id="idGrupo" name="idGrupo" class="form-control" onChange="selecionarLider();">
	<option value="0"><?php echo $this->translate(Constantes::$TRADUCAO_SELECIONE); ?></option>
	<?php echo $this->listagemLideresTransferencia($this->discipulos); ?>
</select>
</div>
<?php

echo $this->inputFormularioSimples('Dia', $formulario->get(Constantes::$FORM_INPUT_DIA), 4, 2);
echo $this->inputFormularioSimples('Mês', $formulario->get(Constantes::$FORM_INPUT_MES), 4, 2);
echo $this->inputFormularioSimples('Ano', $formulario->get(Constantes::$FORM_INPUT_ANO), 4, 2);

echo $this->inputFormularioSimples('Valor Individual', $formulario->get('individual'), 4);
echo $this->inputFormularioSimples('Qual Célula', $formulario->get('idGrupoEvento'), 4, 2);
echo $this->inputFormularioSimples('Valor Célula', $formulario->get('celula'), 4);
?>
	</div>
	<div class="panel-footer">
<?php
echo $this->formHidden($formulario->get(Constantes::$INPUT_CSRF));
$funcao = $this->funcaoOnClick('validar(this.form)');
echo $this->botaoSimples('Salvar Valores', $funcao);
?>        
	</div>
</div>
<?php 
echo $this->form()->closeTag();
?>
<script type="text/javascript">
function validar(formulario){
	let mensagemDeErro = '';
	let temErros = false;
if(formulario.idGrupo.value == 0){
	temErros = true
		if(mensagemDeErro == ''){
			mensagemDeErro = 'Líder';
}else{
	mensagemDeErro += ', Líder';
}
}
	if(formulario.Dia.value == 0){
		temErros = true
			if(mensagemDeErro == ''){
				mensagemDeErro = 'Dia';
}else{
	mensagemDeErro += ', Dia';
}
}
if(formulario.Mes.value == 0){
	temErros = true
		if(mensagemDeErro == ''){
			mensagemDeErro = 'Mês';
}else{
	mensagemDeErro += ', Mês';
}
}
if(formulario.Ano.value == 0){
	temErros = true
		if(mensagemDeErro == ''){
			mensagemDeErro = 'Ano';
}else{
	mensagemDeErro += ', Ano';
}
}

if(formulario.individual.value == ''){
	temErros = true
		if(mensagemDeErro == ''){
			mensagemDeErro = 'Valor do individual';
}else{
	mensagemDeErro += ', Valor do Individual';
}
}
if(formulario.idGrupoEvento.value == 0){
	temErros = true
		if(mensagemDeErro == ''){
			mensagemDeErro = 'Qual célula';
}else{
	mensagemDeErro += ', Qual Célula';
}
}
if(formulario.celula.value == ''){
	temErros = true
		if(mensagemDeErro == ''){
			mensagemDeErro = 'Valor de célula';
}else{
	mensagemDeErro += ', Valor de célula';
}
}
if(!temErros){
	$('#divMEnsagens')
		.addClass('hidden');
	mostrarSplash();
	formulario.submit();
}else{
	$('#divMensagens')
		.html('Preencha os seguintes campos: '+mensagemDeErro)
		.removeClass('hidden')
}
}

function selecionarLider(){
const idGrupo = $('#idGrupo').val();
	$.post(
		"/relatorioBuscarDadosGrupo",
{
	idGrupo: idGrupo
			},
			function (data) {
				if (data.resposta) {
$('#idGrupoEvento').html('<option value="0">Selecione</option>')
					if(data.celulas['1']){
						$('#idGrupoEvento').append('<option value="'+data.celulas['1']['idGrupoEvento']+'">'+data.celulas['1']['nomeHospedeiro']+'</option>')
								}
								if(data.celulas['2']){
									$('#idGrupoEvento').append('<option value="'+data.celulas['2']['idGrupoEvento']+'">'+data.celulas['2']['nomeHospedeiro']+'</option>')
								}
												}
			}, 'json')
}
</script>
